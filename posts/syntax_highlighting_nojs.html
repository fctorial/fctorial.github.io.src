<!DOCTYPE html>
<html lang="en">
<body>
<article>
    <p>
        Syntax highlighted code in a webpage, like this one, is just some html with some styling added to it. For example, this html:
    </p>
    <prog class="language-html">
&lt;pre>
    &lt;span class="token keyword">function&lt;/span>
    &lt;span class="token function">calculate&lt;/span>
    &lt;span class="token punctuation">(&lt;/span>
    &lt;span class="token parameter">n&lt;/span>
    &lt;span class="token punctuation">)&lt;/span>
    &lt;span class="token punctuation">{&lt;/span>
    &lt;span class="token keyword">if&lt;/span>
    &lt;span class="token punctuation">(&lt;/span>n
    &lt;span class="token operator">===&lt;/span>
    &lt;span class="token number">0&lt;/span>
    &lt;span class="token punctuation">)&lt;/span>
    &lt;span class="token punctuation">{&lt;/span>
    &lt;span class="token keyword">return&lt;/span>
    &lt;span class="token number">1&lt;/span>
    &lt;span class="token punctuation">;&lt;/span>
    &lt;span class="token keyword">else&lt;/span>
    &lt;span class="token punctuation">{&lt;/span>
    &lt;span class="token keyword">return&lt;/span>
    n
    &lt;span class="token operator">*&lt;/span>
    &lt;span class="token function">calculate&lt;/span>
    &lt;span class="token punctuation">(&lt;/span>
    n
    &lt;span class="token operator">-&lt;/span>
    &lt;span class="token number">1&lt;/span>
    &lt;span class="token punctuation">)&lt;/span>
    &lt;span class="token punctuation">}&lt;/span>
    &lt;span class="token punctuation">}&lt;/span>
&lt;/pre>
    </prog>
    <p>
        Generates this output when rendered:
    </p>
    <prog class="language-js">
function calculate(n) {
    if (n === 0) {
        return 1;
    else {
        return n * calculate(n-1)
    }
}
    </prog>
    <p>
        As you see, it's just a bit of HTML and CSS. The clients shouldn't have to download and execute javascript to highlight
        code in a webpage. As a matter of fact, syntax highlighting on this page doesn't use javascript either. You can
        verify that by disabling javascript in your browser and reloading this page.
    </p>
    <p>
        It's also better UX wise. You won't see the code in black and white while the syntax highlighting code is doing it's job.
        So you don't have to do any tricks to avoid that either. (like hiding the code blocks while syntax highlighter is working)
    </p>
    <p>
        So how does syntax highlighting work in this page? It uses <a href="https://prismjs.com/">prism.js</a>. But isn't
        that a javascript framework? How do I use prism.js in my website without javascript?
    </p>
    <h4><a href="/posts/constexpr.js.html">constexpr.js</a></h4>
    <p>
        It is a tool that allows you to execute some of the javascript in your webpage beforehand, so that your clients
        don't have to. It allows you to use any javascript library without any fear of bloat. You can use it like a
        full on static site generator, as I do for this website, but it is generic enough to be used for other HTML generation
        use cases as well.
    </p>
    <p>
        When used as a static site generator, you use regular javascript to render the page, instead of an arguably less
        powerful, esoteric templating language that has no use outside of the given framework. As for plugins, you can
        use <em>any</em> javascript library/framework. This code is all you need to integrate prism.js
        in your website.
    </p>
    <prog class="language-js">
async function syntax_highlight() {
  document.querySelectorAll('prog').forEach(el => {
    el.textContent = el.textContent.trim()
  })
  window.Prism = {manual: true};
  eval(await (await fetch("/static/js/constexpr/third_party/prism.js")).text())
  let did_highlight = false
  await Promise.all([...document.querySelectorAll('prog[class]')].map(
    el => new Promise((resolve) => {
      did_highlight = true
      Prism.highlightElement(el, null, () => resolve())
    })
  ))
  if (did_highlight) {
    document.head.appendChild(
      make_element(`&lt;link rel="stylesheet" href="/static/css/prism.css">`)
    )
  }
}
    </prog>
    <p>
        As you can see, it's regular javascript code that uses the prism.js api.
    </p>
    <blockquote>
        See pages tagged with <a class="tag_element" href="/tags/generator.html?constexpr.js">constexpr.js</a> for more guides.
    </blockquote>
</article>
</body>
<script constexpr src="/static/js/constexpr/lib.js"></script>
<script constexpr src="/static/js/constexpr/index.js"></script>
<script constexpr src="/static/js/constexpr/renderer.js"></script>

<script constexpr>
  var tagsToReplace = {
    // '&': '&amp;',
    '<': '&lt;'
    // '>': '&gt;'
  };

  function replaceTag(tag) {
    return tagsToReplace[tag] || tag;
  }

  function safe_tags_replace(str) {
    return str.replace(/[&<>]/g, replaceTag);
  }

  async function page_specific_stuff() {
    // const html = document.querySelector('prog.language-html')
    // html.textContent = safe_tags_replace(html.innerHTML)
    await render_page()
  }
</script>

<script constexpr>
  Promise.all([page_specific_stuff()])
    .then(() => window._ConstexprJS_.compile())
</script>

</html>
