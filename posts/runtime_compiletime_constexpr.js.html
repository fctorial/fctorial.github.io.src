<!DOCTYPE html>
<html lang="en">
<body>
<article>
    <p>
        <a href="/posts/constexpr.js.html">constexpr.js</a> allows you to execute some of the javascript in your website
        before it is deployed. I'll refer to such javascript as <progi>constepxr</progi>. You can use constexpr code for
        programmatically generating HTML in your website.
    </p>
    <p>
        The constexpr code is stripped out by the compiler, so the runtime code must not depend on it. Hence, there has to
        be a clear boundary between the runtime code and compile time code. In this article I'll share some tips for
        managing code when building a site with constexpr.js. I'll be using <a href="/posts/intellij_logos.html">this</a>
        page as an example in this article. Try hovering over the images. The images list in this page is generated
        statically with constexpr.js but the background is being manipulated at runtime with javascript.<br/>
        <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/posts/intellij_logos.html">Original page source</a><br/>.
    </p>
    <p>
        Javascript execution in your website should be split into two phases. The compilation phase and the runtime
        phase. The first thing you should do when building a site is to write the compilation phase code. In the above
        example, it's the code that generates the images list, the background and the navbar. All the compilation phase
        code should be marked as <progi>constexpr</progi>.
    </p>
    <p>
        There should be a regular, non-constexpr method in your website which will bootstrap the runtime code execution.
        (<progi>initHover</progi> in the above example). Once the compilation phase code has finished rendering the page,
        it should append a script tag to the DOM that calls this method:
    </p>
        <prog class="language-javascript">
...
const init = document.createElement('script')
init.innerText = 'initHover()'
document.querySelector('html').appendChild(init)
...
        </prog>
    <p>
        This will accomplish two things:
    </p>
    <ol>
        <li>
            Newly added script tags are executed immediately by the browser. So the<progi>initHover</progi> method will
            be called after the HTML structure has been generated in the original website.
        </li>
        <li>
            Since the constexpr code is stripped out before snapshotting the website, the output HTML will contain only
            three things:
            <ol>
                <li>Generated HTML</li>
                <li>Runtime bootstrap function <progi>initHover</progi></li>
                <li>A script tag that calls the bootstrap function</li>
            </ol>
        </li>
    </ol>
    <blockquote>
        See pages tagged with <a class="tag_element" href="/tags/generator.html?constexpr.js">constexpr.js</a> for more guides.
    </blockquote>
</article>
</body>
<script constexpr src="/static/js/constexpr/lib.js"></script>
<script constexpr src="/static/js/constexpr/renderer.js"></script>

<script constexpr>
  async function page_specific_stuff() {
  }
</script>

<script constexpr>
  Promise.all([site_global_rendering(), page_specific_stuff()])
    .then(() => window._ConstexprJS_.compile())
</script>

</html>
