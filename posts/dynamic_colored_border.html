<!DOCTYPE html>
<html lang="en">
<body>
<article>
    <p>
        In today's article, I'm going to describe how to add dynamic colored borders to an element in your webpage,
        similar to the one you see on this page. After that, I'll talk about some details specific to the implementation
        in this page, which is statically generated with <a href="/posts/constexpr.js.html">constexpr.js</a>.
    </p>
    <p>
        Let's say this is the element you want to add a dynamic border to:
    </p>
    <div class="diagram">
        <div class="main_content">
            Content
        </div>
    </div>
    <prog class="language-css">
.main_content {
    background: lightgrey;
    width: 10em;
    height: 10em;

    display: flex;
    align-items: center;
    justify-content: center;
}
    </prog>
    <div class="divider"></div>
    <p>
        1. First thing your should do is wrap this element inside another div, and add a tiny amount of padding to the
        outer div. That padding will act as the border you see on this page.
    </p>
    <div class="diagram">
        <div class="wstage1">
            <div class="main_content">
                Content
            </div>
        </div>
    </div>
    <prog class="language-css">
.wstage1 {
    display: inline-block;
    padding: 5px;
    background: white;
}
    </prog>
    <div class="divider"></div>
    <p>
        2. After that add some colors to the wrapper div. A linear-gradient should do the job:
    </p>
    <div class="diagram">
        <div class="wstage1 wstage2">
            <div class="main_content">
                Content
            </div>
        </div>
    </div>
    <prog class="language-css">
.wstage2 {
    background: linear-gradient(
            45deg,
            red, blue, green,
            red, blue, green,
            red, blue, green,
            red, blue, green,
            red, blue, green
    );
    background-size: 300% 300%;
}
    </prog>
    <div class="divider"></div>
    <p>
        3. Now we animate the background:
    </p>
    <div class="diagram">
        <div class="wstage1 wstage2 wstage3">
            <div class="main_content">
                Content
            </div>
        </div>
    </div>
    <prog class="language-css">
@keyframes animatedgradient {
    0% {
        background-position: 0 50%;
    }
    50% {
        background-position: 50% 50%;
    }
    100% {
        background-position: 100% 50%;
    }
}
.wstage3 {
    animation: animatedgradient 8s linear alternate infinite;
}
    </prog>

    <p>
        To be honest, this looks more like diwali material than holi material, but whatever.
    </p>

    <h2>Notes</h2>
    <p>
        Another method of doing this is adding an <progi>::after</progi> element to the content, making it slightly
        bigger than the content element (<progi>width: calc(100% + 4px);</progi>), and animating the background on that pseudo
        element. This is a css only solution (doesn't require changing the markup, or writing javascript that changes the
        markup), but it has some cons:
    </p>
    <ol>
        <li>It doesn't play well with <progi>overflow: hidden;</progi></li>
        <li>
            The <progi>::after</progi> pseudo-element extends outside of the content bounds, so it might interfere with
            the surrounding elements. So you can not use this method if your target element is right next to some other
            element.
        </li>
    </ol>
    <p>
        The method described in this article doesn't have these disadvantages. And, with constexpr.js, you can use this
        method without changing the markup <em>or</em> runtime javascript.
    </p>

    <h2>The implementation in this website</h2>
    <p>
        You can find the source of this page <a target="_blank" href="https://github.com/fctorial/fctorial.github.io.src/blob/5ecf18aff413b63c600690df680121344ec976c3/posts/dynamic_colored_border.html">here</a>.
    </p>
    <p>
        Every page on this site contains these two constexpr script tags:
    </p>
    <prog class="language-html">
&lt;script constexpr>
  async function render_page() {
    // ...
    const base_page_render = site_global_rendering()
    // ...
    await base_page_render
    // ...
  }
&lt;/script>

&lt;script constexpr>
  render_page()
    .then(() => window._ConstexprJS_.compile())
&lt;/script>
    </prog>
    <p>
        <progi>site_global_rendering()</progi> generates all the markup that is common among all the pages on this site
        (nav, header, footer, syntax highlighting etc). Individual pages can add code that depends on the markup
        generated by this method after the await call.
    </p>
    <p>
        The rendering code on this page waits for the site global rendering to finish, which generates the following
        markup:
        <prog class="language-html">
&lt;div id="body_wrapper">
    &lt;header>&lt;/header>
    &lt;article>&lt;/article>
    &lt;footer>&lt;/footer>
&lt;/div>
        </prog>
    </p>
    <p>
        And adds another wrapper around it that does the holi decoration:
        <prog class="language-html">
&lt;script constexpr>
  async function render_page() {
    const base_page_render = site_global_rendering()
    await base_page_render

    const hw = make_element(`&lt;div id="holi_wrapper">&lt;/div>`)
    hw.appendChild(body_wrapper)
    document.body.appendChild(hw)
  }
&lt;/script>
        </prog>
    </p>
    <p>
        Since all this code is constexpr, this wrapping is done at compile time, and you get a site which enjoys
        the best of both worlds.
    </p>
</article>
</body>
<script constexpr src="/static/js/constexpr/lib.js"></script>
<script constexpr src="/static/js/constexpr/index.js"></script>
<script constexpr src="/static/js/constexpr/renderer.js"></script>

<script constexpr>
  async function render_page() {
    const base_page_render = site_global_rendering()
    await base_page_render

    const hw = make_element(`<div id="holi_wrapper"></div>`)
    hw.appendChild(body_wrapper)
    document.body.appendChild(hw)
  }
</script>

<script constexpr>
  render_page()
    .then(() => window._ConstexprJS_.compile())
</script>

<style>
    @keyframes animatedgradient {
        0% {
            background-position: 0 50%;
        }
        50% {
            background-position: 50% 50%;
        }
        100% {
            background-position: 100% 50%;
        }
    }

    .diagram {
        font-style: italic;
        display: flex;
        justify-content: center;
    }

    .main_content {
        background: lightgrey;
        width: 10em;
        height: 10em;

        display: flex;
        align-items: center;
        justify-content: center;
    }

    .wstage1 {
        display: inline-block;
        padding: 5px;
        background: white;
    }

    .wstage2 {
        background: linear-gradient(
                45deg,
                red, blue, green,
                red, blue, green,
                red, blue, green,
                red, blue, green,
                red, blue, green
        );
        background-size: 300% 300%;
    }

    .wstage3 {
        animation: animatedgradient 8s linear alternate infinite;
    }

    #holi_wrapper {
        overflow: hidden;
        padding: 4px;
        background: linear-gradient(
                45deg,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta,
                red, yellow, green, cyan, blue, magenta
        );
        animation: animatedgradient 8s linear alternate infinite;
        will-change: background-position;
        background-size: 600% 600%;
    }

    .divider {
        width: 80%;
        margin: auto;
        height: 2px;
        background: #a7a5a5;
    }

</style>

</html>
